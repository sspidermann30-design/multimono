<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Brand Tycoon Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: #121212;
            --cell-bg: #1e1e1e;
            --p1-color: #ff4757;
            --accent-blue: #1e90ff;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* –ú–ï–ù–Æ */
        .overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle, #222 0%, #000 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .menu-content {
            text-align: center;
            width: 80%;
            background: #222;
            padding: 30px;
            border-radius: 25px;
            border: 1px solid #444;
        }

        /* –ü–û–õ–ï */
        #game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        #board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(12, 1fr);
            gap: 2px;
            width: 95vw;
            height: 80vh;
            background: #333;
            position: relative;
        }

        .cell {
            background: var(--cell-bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            text-align: center;
            position: relative;
        }

        .cell img { width: 60%; max-height: 25px; object-fit: contain; }

        .group-line { position: absolute; top: 0; left: 0; width: 100%; height: 4px; }

        /* –¶–ï–ù–¢–† */
        .board-center {
            grid-column: 2 / 6;
            grid-row: 2 / 12;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
        }

        /* –ö–ê–†–¢–û–ß–ö–ê */
        .buy-card {
            background: white;
            color: black;
            padding: 20px;
            border-radius: 15px;
            width: 85%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .btn {
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin-top: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .btn-buy { background: #2ed573; color: white; }
        .btn-stock { background: #ffa502; color: white; }
        .btn-invite { background: #3498db; color: white; }
        
        .btn-roll {
            background: var(--accent-blue);
            color: white;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            margin: 10px 0;
        }

        /* –§–ò–®–ö–ê */
        .player {
            width: 14px;
            height: 14px;
            background: var(--p1-color);
            border-radius: 50%;
            border: 2px solid white;
            position: absolute;
            z-index: 100;
            transition: all 0.25s linear; /* –õ–∏–Ω–µ–π–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ —à–∞–≥–æ–≤ */
        }

        .level-tag {
            position: absolute;
            bottom: 2px; right: 2px;
            background: #ffa502; color: black;
            font-size: 7px; padding: 1px 3px; border-radius: 3px;
        }

        @keyframes moneyFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-30px); opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="lobby" class="overlay">
        <div class="menu-content">
            <h1>BRAND TYCOON</h1>
            <button class="btn btn-buy" style="font-size: 18px; height: 60px;" onclick="start()">–ò–ì–†–ê–¢–¨</button>
            <button class="btn btn-invite" onclick="inviteFriend()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê ‚úâÔ∏è</button>
        </div>
    </div>

    <div id="game-container">
        <div id="board">
            <div class="board-center" id="centerArea">
                <h2 style="color:#222">BRAND TYCOON</h2>
            </div>
        </div>
        <div id="status" style="padding: 10px;">–ë–∞–ª–∞–Ω—Å: <span id="money" style="color:#2ed573; font-weight:bold;">2500</span>$</div>
        <button id="rollBtn" class="btn-roll" onclick="roll()">–ö–£–ë–ò–ö üé≤</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const brands = [
            {n:"NVIDIA", p:150, c:"#76b900", img:"img/nvidia.png", group:"IT"},
            {n:"Apple", p:200, c:"#76b900", img:"img/apple.png", group:"IT"},
            {n:"Google", p:250, c:"#76b900", img:"img/google.png", group:"IT"},
            {n:"Amazon", p:300, c:"#ff9900", img:"img/amazon.png", group:"Shop"},
            {n:"eBay", p:280, c:"#ff9900", img:"img/ebay.png", group:"Shop"},
            {n:"Tesla", p:400, c:"#e74c3c", img:"img/tesla.png", group:"Auto"},
            {n:"BMW", p:350, c:"#e74c3c", img:"img/bmw.png", group:"Auto"},
            {n:"Nike", p:200, c:"#3498db", img:"img/nike.png", group:"Style"},
            {n:"Adidas", p:180, c:"#3498db", img:"img/adidas.png", group:"Style"},
            {n:"Pepsi", p:120, c:"#f1c40f", img:"img/pepsi.png", group:"Drink"},
            {n:"Coca Cola", p:130, c:"#f1c40f", img:"img/coca.png", group:"Drink"},
            {n:"Rolex", p:500, c:"#9b59b6", img:"img/rolex.png", group:"Lux"}
        ];

        const chanceCards = [
            { text: "–ù–∞–ª–æ–≥–æ–≤—ã–π —à—Ç—Ä–∞—Ñ: -150$", action: () => updateBalance(-150) },
            { text: "–ü—Ä–∏–±—ã–ª—å —Å –∞–∫—Ü–∏–π: +200$", action: () => updateBalance(200) },
            { text: "–ö—ç—à–±—ç–∫ –∑–∞ –ø–æ–∫—É–ø–∫–∏: +100$", action: () => updateBalance(100) },
            { text: "–†–µ–º–æ–Ω—Ç –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è: -200$", action: () => updateBalance(-200) }
        ];

        let pos = 0;
        let balance = 2500;
        const totalCells = 32; 
        const ownedCells = {}; 
        const stockLevels = {};
        let isMoving = false;

        function updateBalance(amount) {
            balance += amount;
            document.getElementById('money').innerText = balance;
        }

        function inviteFriend() {
            const botUrl = "https://t.me/—Ç–≤–æ–π_–±–æ—Ç_—é–∑–µ—Ä–Ω–µ–π–º/app"; // –°–Æ–î–ê –í–ü–ò–®–ò –°–°–´–õ–ö–£
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(botUrl)}&text=–î–∞–≤–∞–π –∏–≥—Ä–∞—Ç—å –≤ –ú–æ–Ω–æ–ø–æ–ª–∏—é –±—Ä–µ–Ω–¥–æ–≤!`);
        }

        function start() {
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            drawBoard();
        }

        function drawBoard() {
            const board = document.getElementById('board');
            let bIdx = 0;
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.id = `c${i}`;
                let r, c;
                if (i < 6) { r = 1; c = i + 1; }
                else if (i < 17) { r = i - 4; c = 6; }
                else if (i < 22) { r = 12; c = 6 - (i - 16); }
                else { r = 12 - (i - 21); c = 1; }
                cell.style.gridRow = r; cell.style.gridColumn = c;

                if (i === 0) cell.innerHTML = "<b>–°–¢–ê–†–¢</b><br>+200$";
                else if (i === 5) cell.innerHTML = "<b>–¢–Æ–†–¨–ú–ê</b>";
                else if (i === 16) cell.innerHTML = "<b>–û–¢–î–´–•</b>";
                else if (i === 21) cell.innerHTML = "<b>–í –¢–Æ–†–¨–ú–£</b>";
                else if (i % 7 === 0) { cell.innerHTML = "<b>–®–ê–ù–°</b>"; cell.style.color = "#1e90ff"; }
                else {
                    const b = brands[bIdx % brands.length];
                    cell.innerHTML = `<div class="group-line" style="background:${b.c}"></div><img src="${b.img}"><span>${b.p}$</span>`;
                    cell.dataset.brandIdx = bIdx % brands.length;
                    bIdx++;
                }
                board.appendChild(cell);
            }
            const p = document.createElement('div');
            p.className = 'player'; p.id = 'p1';
            board.appendChild(p);
            updateTokenPos();
        }

        function updateTokenPos() {
            const cell = document.getElementById(`c${pos}`);
            const p = document.getElementById('p1');
            p.style.left = (cell.offsetLeft + (cell.offsetWidth/2) - 7) + 'px';
            p.style.top = (cell.offsetTop + (cell.offsetHeight/2) - 7) + 'px';
        }

        async function roll() {
            if (isMoving) return;
            isMoving = true;
            document.getElementById('rollBtn').disabled = true;

            const steps = Math.floor(Math.random() * 6) + 1;
            const center = document.getElementById('centerArea');
            center.innerHTML = `<h1>üé≤ ${steps}</h1>`;

            for (let i = 0; i < steps; i++) {
                pos = (pos + 1) % totalCells;
                
                // –≠—Ñ—Ñ–µ–∫—Ç –ø—Ä–æ—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ –°—Ç–∞—Ä—Ç
                if (pos === 0) {
                    updateBalance(200);
                    showMoneyPopup();
                }

                updateTokenPos();
                await new Promise(r => setTimeout(r, 400)); // –°–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è
            }

            processCell();
            isMoving = false;
            document.getElementById('rollBtn').disabled = false;
        }

        function showMoneyPopup() {
            const popup = document.createElement('div');
            popup.innerText = "+200$";
            popup.style = "position:absolute; color:#2ed573; font-weight:bold; animation: moneyFloat 1s forwards; z-index:200;";
            document.getElementById(`c0`).appendChild(popup);
            setTimeout(() => popup.remove(), 1000);
        }

        function processCell() {
            const cell = document.getElementById(`c${pos}`);
            const bIdx = cell.dataset.brandIdx;
            const center = document.getElementById('centerArea');

            if (bIdx !== undefined) {
                const b = brands[bIdx];
                if (!ownedCells[pos]) {
                    showBuyCard(b);
                } else {
                    if (isGroupComplete(b.group)) showUpgradeCard(b);
                    else center.innerHTML = `<h3>${b.n}</h3><p>–í–∞—à –∞–∫—Ç–∏–≤</p>`;
                }
            } else {
                const text = cell.innerText;
                if (text.includes("–®–ê–ù–°")) showChance();
                else if (text.includes("–í –¢–Æ–†–¨–ú–£")) {
                    pos = 5;
                    setTimeout(() => { updateTokenPos(); center.innerHTML = "<h3>–ê–†–ï–°–¢!</h3>"; }, 400);
                } else center.innerHTML = `<h3>${text}</h3>`;
            }
        }

        function showBuyCard(b) {
            document.getElementById('centerArea').innerHTML = `
                <div class="buy-card">
                    <img src="${b.img}" style="width:40px">
                    <h2>${b.n}</h2>
                    <button class="btn btn-buy" onclick="buyProcess(${b.p})">–ö–£–ü–ò–¢–¨ –ó–ê ${b.p}$</button>
                </div>`;
        }

        function buyProcess(price) {
            if (balance >= price) {
                updateBalance(-price);
                ownedCells[pos] = true;
                document.getElementById(`c${pos}`).style.background = 'rgba(255, 71, 87, 0.4)';
                document.getElementById('centerArea').innerHTML = "<h3>–ö—É–ø–ª–µ–Ω–æ!</h3>";
            }
        }

        function isGroupComplete(group) {
            const groupTotal = brands.filter(b => b.group === group).length;
            const myTotal = brands.filter((b, i) => {
                const cell = Array.from(document.querySelectorAll('.cell')).find(c => c.dataset.brandIdx == i);
                return cell && ownedCells[cell.id.replace('c','')];
            }).length;
            return myTotal >= groupTotal;
        }

        function showUpgradeCard(b) {
            const lvl = stockLevels[pos] || 0;
            const cost = Math.floor(b.p * 0.8);
            document.getElementById('centerArea').innerHTML = `
                <div class="buy-card" style="border: 2px solid gold">
                    <h2>–ê–∫—Ü–∏–∏ ${b.n}</h2>
                    <p>Lvl: ${lvl}</p>
                    <button class="btn btn-stock" onclick="upgradeProcess(${cost})">–ö–£–ü–ò–¢–¨ –ê–ö–¶–ò–Æ ${cost}$</button>
                </div>`;
        }

        function upgradeProcess(cost) {
            if (balance >= cost) {
                updateBalance(-cost);
                stockLevels[pos] = (stockLevels[pos] || 0) + 1;
                const c = document.getElementById(`c${pos}`);
                if (!c.querySelector('.level-tag')) {
                    const t = document.createElement('div'); t.className = 'level-tag'; c.appendChild(t);
                }
                c.querySelector('.level-tag').innerText = 'Lvl ' + stockLevels[pos];
                document.getElementById('centerArea').innerHTML = "<h3>Lvl UP!</h3>";
            }
        }

        function showChance() {
            const card = chanceCards[Math.floor(Math.random() * chanceCards.length)];
            document.getElementById('centerArea').innerHTML = `
                <div class="buy-card" style="border: 2px dashed #1e90ff">
                    <h2 style="color:#1e90ff">–®–ê–ù–° ‚ùì</h2>
                    <p>${card.text}</p>
                    <button class="btn btn-buy" onclick="applyChance(${chanceCards.indexOf(card)})">OK</button>
                </div>`;
        }

        function applyChance(idx) {
            chanceCards[idx].action();
            document.getElementById('centerArea').innerHTML = "<h3>–í—ã–ø–æ–ª–Ω–µ–Ω–æ!</h3>";
        }
    </script>
</body>
</html>
